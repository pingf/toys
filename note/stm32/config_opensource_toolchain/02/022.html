<head>
  <meta http-equiv="Content-type" content="text/html; charset=utf-8"/>
  <title>02</title>
<link href="../../../../lib/prettify.js/prettify.css" type="text/css" rel="stylesheet" />
<script type="text/javascript" src="../../../../lib/prettify.js/prettify.js"></script> 
<style>
li.L0, li.L1, li.L2, li.L3,
li.L5, li.L6, li.L7, li.L8
{ list-style-type: decimal !important }
</style>
</head>

<body id="02" onload="prettyPrint()">
	

<h1>Eclipse与OpenOCD的配置</h1>
<hr />
  <p>版权声明:</p>
  <p>作者:Jesse MENG →_→ 爱科学爱和平的大M君</p> 
  <p>邮箱:<a href="mailto:pingf0@gmail.com?subject=feedback on codeBenchDemo">pingf0@gmail.com</a></p>
  
  <p>
 <a rel="license" href="http://creativecommons.org/licenses/by-sa/3.0/"><img alt="知识共享许可协议" style="border-width:0" src="http://i.creativecommons.org/l/by-sa/3.0/88x31.png" /></a><br />本<span xmlns:dct="http://purl.org/dc/terms/" href="http://purl.org/dc/dcmitype/Text" rel="dct:type">作品</span>采用<a rel="license" href="http://creativecommons.org/licenses/by-sa/3.0/">知识共享署名-相同方式共享 3.0 Unported许可协议</a>进行许可。
 </p>
 <hr /> 
<p>在<a href="../01/01.html">上篇</a>文章中已经搞定了工程的配置和编译,此篇将介绍如何通过OpenOCD和gdb将编译好的elf文件下载到STM32F4Discovery板子中去.</p>

<a href="../../../../download/openocd-0.7.0.7z">点我下载编译好的win版openocd</a>

<hr />
<img src="openocd.png" style="float: left">

<pre class="prettyprint lang-cpp linenums:1" >
source [find interface/stlink-v2.cfg] 
source [find target/stm32f4x_stlink.cfg] 
reset_config srst_only srst_nogate
</pre>
<p>在openocd的配置文件中使用source即从另外的文件中加载配置,可以在对应的目录中找到stlink-v2.cfg和stm32f4x_stlink.cfg.这里要注意interface文件要先于target文件来配置</p> 
<p>工程中core目录下的stm32f4discovery.cfg是把使用source命令引用的文件复制进来的所以只有一个就够了</p>  
<hr style="clear: left" />
<p>完整的单文件cfg配置文件如下</p> 
<pre class="prettyprint lang-cpp linenums:1">
interface hla
hla_layout stlink
hla_device_desc "ST-LINK/V2"
hla_vid_pid 0x0483 0x3748

####################


if { [info exists CHIPNAME] == 0 } {
   set CHIPNAME stm32f4x
}

if { [info exists CPUTAPID] == 0 } {
   set CPUTAPID 0x2ba01477
}

if { [info exists WORKAREASIZE] == 0 } {
   set WORKAREASIZE 0x10000
}

####################
#
# stm32 stlink pseudo target
#

if { [info exists CHIPNAME] } {
   set _CHIPNAME $CHIPNAME
} else {
   set _CHIPNAME stm32f1x
}

# Work-area is a space in RAM used for flash programming
# By default use 4kB (as found on some STM32F100s)
if { [info exists WORKAREASIZE] } {
   set _WORKAREASIZE $WORKAREASIZE
} else {
   set _WORKAREASIZE 0x1000
}

if { [info exists CPUTAPID] } {
   set _CPUTAPID $CPUTAPID
} else {
   # this is the SW-DP tap id not the jtag tap id
   set _CPUTAPID 0x1ba01477
}

if { [info exists TRANSPORT] } {
   set _TRANSPORT $TRANSPORT
   if { $TRANSPORT == "hla_jtag" } {
      if { [info exists CPUTAPID] == 0 } {
         # jtag requires us to use the jtag tap id
         set _CPUTAPID 0x3ba00477
      }
   }
} else {
   set _TRANSPORT hla_swd
}

# add deprecated transport name check
if { $_TRANSPORT == "stlink_swd" } {
    set _TRANSPORT "hla_swd"
    echo "DEPRECATED! use 'hla_swd' transport not 'stlink_swd'"
}

if { $_TRANSPORT == "stlink_jtag" } {
    set _TRANSPORT "hla_jtag"
    echo "DEPRECATED! use 'hla_jtag' transport not 'stlink_jtag'"
}
# end deprecated checks

#
# possibles value are hla_swd or hla_jtag
#
transport select $_TRANSPORT

hla newtap $_CHIPNAME cpu -expected-id $_CPUTAPID

set _TARGETNAME $_CHIPNAME.cpu
target create $_TARGETNAME hla_target -chain-position $_TARGETNAME

$_TARGETNAME configure -work-area-phys 0x20000000 -work-area-size $_WORKAREASIZE -work-area-backup 0 
#################### 
# stm32f4x family uses stm32f2x driver
set _FLASHNAME $_CHIPNAME.flash
flash bank $_FLASHNAME stm32f2x 0 0 0 0 $_TARGETNAME 
####################
# use hardware reset, connect under reset
reset_config srst_only srst_nogate
</pre> 
<p>下载</p>
<hr />

 </body>